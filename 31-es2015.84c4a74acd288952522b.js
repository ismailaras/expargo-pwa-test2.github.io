(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{DXzT:function(e,t,i){"use strict";i.r(t),i.d(t,"OrdersPageModule",(function(){return F}));var n=i("ofXK"),o=i("3Pt+"),r=i("TEn/"),s=i("tyNb"),a=i("mrSG"),l=i("y+FX"),c=i("GaRv"),b=i("Mky/"),d=i("AxNX"),h=i("fXoL"),u=i("kVqo"),g=i("ndxW"),f=i("qfBg"),m=i("Ymxs"),p=i("Nm8O"),O=i("e8h1");function y(e,t){if(1&e){const e=h.Qb();h.Pb(0,"ion-toolbar",1),h.Pb(1,"ion-searchbar",9),h.Xb("ngModelChange",(function(t){return h.oc(e),h.Zb().keyword=t}))("ionChange",(function(){return h.oc(e),h.Zb().search()})),h.Ob(),h.Ob()}if(2&e){const e=h.Zb();h.zb(1),h.gc("ngModel",e.keyword)}}function P(e,t){if(1&e&&(h.Pb(0,"ion-select-option",16),h.uc(1),h.Ob()),2&e){const e=t.$implicit,i=t.index,n=h.Zb(3);h.gc("value",i),h.zb(1),h.wc(" ",n.stateService.getOrderStateInAzerbaijani(e)," ")}}function k(e,t){if(1&e){const e=h.Qb();h.Pb(0,"ion-item",14),h.Pb(1,"ion-label"),h.uc(2,"Filtr"),h.Ob(),h.Pb(3,"ion-select",15),h.Xb("ngModelChange",(function(t){return h.oc(e),h.Zb(2).filterKey=t}))("ionChange",(function(){return h.oc(e),h.Zb(2).filterOrders()})),h.Pb(4,"ion-select-option",16),h.uc(5," Filtr se\xe7ilm\u0259yib "),h.Ob(),h.sc(6,P,2,2,"ion-select-option",17),h.ac(7,"slice"),h.Ob(),h.Ob()}if(2&e){const e=h.Zb(2);h.zb(3),h.gc("ngModel",e.filterKey),h.zb(1),h.gc("value","none"),h.zb(2),h.gc("ngForOf",h.cc(7,3,e.orderStateData,0))}}function v(e,t){if(1&e){const e=h.Qb();h.Pb(0,"ion-item-option",31),h.Xb("click",(function(){h.oc(e);const t=h.Zb().$implicit;return h.Zb(3).pay([t])})),h.Kb(1,"ion-icon",32),h.Pb(2,"ion-label"),h.uc(3," \xd6d\u0259 "),h.Ob(),h.Ob()}}function x(e,t){if(1&e){const e=h.Qb();h.Pb(0,"ion-col",19),h.Pb(1,"ion-item-sliding"),h.Pb(2,"ion-item",20),h.Pb(3,"ion-thumbnail",2),h.Kb(4,"ion-img",21),h.Ob(),h.Pb(5,"ion-label",22),h.Pb(6,"ion-text",23),h.Pb(7,"h3"),h.uc(8),h.Ob(),h.Ob(),h.Pb(9,"ion-text",24),h.Pb(10,"p"),h.uc(11),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Pb(12,"ion-item-options",25),h.Pb(13,"ion-item-option",26),h.Xb("click",(function(){h.oc(e);const i=t.$implicit;return h.Zb(3).goUrl(i)})),h.Kb(14,"ion-icon",27),h.Pb(15,"ion-label"),h.uc(16," URL "),h.Ob(),h.Ob(),h.sc(17,v,4,0,"ion-item-option",28),h.Pb(18,"ion-item-option",29),h.Xb("click",(function(){h.oc(e);const i=t.$implicit;return h.Zb(3).presentTrackingModal(i)})),h.Kb(19,"ion-icon",30),h.Pb(20,"ion-label"),h.uc(21," \u0130zl\u0259 "),h.Ob(),h.Ob(),h.Ob(),h.Ob(),h.Ob()}if(2&e){const e=t.$implicit,i=t.index,n=h.Zb(3);h.zb(2),h.ic("routerLink","/dashboard/orders/order/",e.id,""),h.gc("color",n.platform.is("mobile")&&i%2!=0?"light":null)("lines",n.platform.is("mobile")?"none":null),h.zb(2),h.gc("src","/assets/img/orders_thumbnail.png"),h.zb(4),h.vc(e.id),h.zb(3),h.wc(" ",n.stateService.getOrderStateInAzerbaijani(e.current_state.toString())," "),h.zb(6),h.gc("ngIf","Incomplete"===e.current_state.toString())}}function w(e,t){if(1&e&&(h.Pb(0,"ion-grid"),h.Pb(1,"ion-row"),h.sc(2,x,22,7,"ion-col",18),h.Ob(),h.Ob()),2&e){const e=h.Zb(2);h.zb(2),h.gc("ngForOf",e.orders)}}function z(e,t){1&e&&(h.Pb(0,"ion-card",1),h.Pb(1,"ion-card-content"),h.uc(2," He\xe7 bir sifari\u015f tap\u0131lmad\u0131. "),h.Ob(),h.Ob())}function C(e,t){if(1&e){const e=h.Qb();h.Pb(0,"ion-content"),h.Pb(1,"ion-refresher",10),h.Xb("ionRefresh",(function(){return h.oc(e),h.Zb().doRefresh()})),h.Kb(2,"ion-refresher-content"),h.Ob(),h.sc(3,k,8,6,"ion-item",11),h.sc(4,w,3,1,"ion-grid",12),h.sc(5,z,3,0,"ng-template",null,13,h.tc),h.Ob()}if(2&e){const e=h.mc(6),t=h.Zb();h.zb(3),h.gc("ngIf",t.isFilterActive),h.zb(1),h.gc("ngIf",t.orders.length>0)("ngIfElse",e)}}function S(e,t){1&e&&(h.Pb(0,"ion-content"),h.Pb(1,"ion-grid",33),h.Pb(2,"ion-row",34),h.Pb(3,"ion-col",35),h.Kb(4,"ion-spinner",23),h.Ob(),h.Ob(),h.Ob(),h.Ob())}const M=[{path:"",component:(()=>{class e{constructor(e,t,i,n,o,r,s,a,l){this.orderService=e,this.platform=t,this.stateService=i,this.alertCtrl=n,this.userService=o,this.toaster=r,this.helper=s,this.modalController=a,this.storage=l,this.isFilterActive=!0,this.isSearchActive=!1,this.orders=[],this.isLoading=!1,this.filterKey="none",this.user=new b.a,this.missing_fee=0}ionViewWillEnter(){this.filterOrders()}ngOnInit(){}showAlert(e){this.alertCtrl.create({header:"X\u0259ta a\u015fkarland\u0131",message:e,buttons:["Tamam"]}).then(e=>e.present())}filterOrders(){this.isLoading=!0,this.storage.get("access_token").then(e=>{this.orderService.getOrders(this.helper.decodeToken(e).identity).subscribe(e=>{this.orders="none"!==this.filterKey?e.filter(e=>l.a[e.current_state.toString()]===Number(this.filterKey)):e,this.isLoading=!1},e=>{this.isLoading=!1,404!==e.status&&this.showAlert("Bilinm\u0259y\u0259n bir x\u0259ta ba\u015f verdi. Z\u0259hm\u0259t olmasa, daha sonra t\u0259krar yoxlay\u0131n.")})})}doRefresh(){this.filterOrders()}get orderStateData(){return Object.keys(l.a).filter(e=>!isNaN(Number(l.a[e])))}search(){}presentTrackingModal(e){return Object(a.a)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:c.a,swipeToClose:!0,componentProps:{states:e.states}});return yield t.present()}))}goUrl(e){window.open(e.url,"_blank")}presentCheckoutModal(e,t){return Object(a.a)(this,void 0,void 0,(function*(){const i=yield this.modalController.create({component:d.a,swipeToClose:!0,cssClass:"checkoutModal",componentProps:{amount:e,currency:t}});return yield i.present()}))}showConfirm(e,t){this.alertCtrl.create({header:"\xd6d\u0259ni\u015f et",message:e,buttons:[{text:"L\u0259v\u011f et",role:"cancel"},{text:"Balans art\u0131r",handler:()=>{this.presentCheckoutModal(this.missing_fee,"TRY").then(e=>console.log(e))}},{text:"Tamamla",handler:()=>{this.completePayment(t)}}]}).then(e=>e.present())}pay(e){this.isLoading=!0,this.storage.get("access_token").then(t=>{this.userService.getDetail(this.helper.decodeToken(t).identity).subscribe(t=>{this.isLoading=!1,this.user=t;const i=e.filter(e=>"Incomplete"===e.current_state.toString());this.getOrdersMissingFee(i),0!==this.missing_fee?this.showConfirm(`\n                    Hal-haz\u0131rk\u0131 balans: \u20ba${this.user.wallet_try.toFixed(2)}<br>\n                    Natamam m\u0259bl\u0259\u011f: \u20ba${this.missing_fee.toFixed(2)}<br>\n                    <hr>\n                    <small>Balans\u0131n\u0131zda kifay\u0259t q\u0259d\u0259r v\u0259sait yoxdursa, z\u0259hm\u0259t olmasa, balans art\u0131r d\xfcym\u0259sini s\u0131x\u0131n.</small>\n                `,i):this.showAlert("Natamam \xf6d\u0259ni\u015fli sifari\u015f tap\u0131lmad\u0131.")},e=>{this.isLoading=!1,this.showAlert("Bilinm\u0259y\u0259n bir x\u0259ta ba\u015f verdi. Z\u0259hm\u0259t olmasa, daha sonra t\u0259krar yoxlay\u0131n.")})})}getOrdersMissingFee(e){this.missing_fee=0,e.forEach(e=>this.missing_fee+=e.missing_fee)}completePayment(e){this.orderService.setOrdersToReadyToOrder(e,this.missing_fee,this.user.id).subscribe(e=>{"User's wallet is not enough for payment."===JSON.parse(e).message?this.toaster.danger("Balans\u0131n\u0131zda kifay\u0259t q\u0259d\u0259r v\u0259sait yoxdur."):(this.filterOrders(),this.toaster.success("\xd6d\u0259ni\u015finiz u\u011furla ba\u015fa \xe7atd\u0131."))},e=>{this.showAlert("Bilinm\u0259y\u0259n bir x\u0259ta ba\u015f verdi. Z\u0259hm\u0259t olmasa, daha sonra t\u0259krar yoxlay\u0131n.")})}}return e.\u0275fac=function(t){return new(t||e)(h.Jb(u.a),h.Jb(r.ib),h.Jb(g.a),h.Jb(r.a),h.Jb(f.a),h.Jb(m.a),h.Jb(p.b),h.Jb(r.fb),h.Jb(O.b))},e.\u0275cmp=h.Db({type:e,selectors:[["app-orders"]],decls:14,vars:4,consts:[[3,"translucent"],["color","tertiary"],["slot","start"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","md","card-sharp","ios","card-outline"],["slot","icon-only","md","filter-sharp","ios","filter-outline"],["color","tertiary",4,"ngIf"],[4,"ngIf"],["color","tertiary","placeholder","Axtar",1,"ion-no-padding",3,"ngModel","ngModelChange","ionChange"],["slot","fixed",3,"ionRefresh"],["lines","full","color","light",4,"ngIf"],[4,"ngIf","ngIfElse"],["notOrders",""],["lines","full","color","light"],["multiple","false","cancelText","Ba\u011fla","okText","T\u018fSD\u0130QL\u018f",3,"ngModel","ngModelChange","ionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["size-md","6","size","12",4,"ngFor","ngForOf"],["size-md","6","size","12"],["button","",3,"routerLink","color","lines"],[1,"ion-padding",3,"src"],[1,"ion-text-wrap"],["color","primary"],["color","secondary"],["side","end"],["color","secondary","expandable","",3,"click"],["slot","top","ios","link-outline","md","link-sharp"],["color","medium","expandable","",3,"click",4,"ngIf"],["color","tertiary","expandable","",3,"click"],["slot","top","ios","airplane-outline","md","airplane-sharp"],["color","medium","expandable","",3,"click"],["slot","top","ios","card-outline","md","card-sharp"],[2,"height","100%"],[1,"ion-justify-content-center","ion-align-items-center",2,"height","100%"],[1,"ion-text-center"]],template:function(e,t){1&e&&(h.Pb(0,"ion-header",0),h.Pb(1,"ion-toolbar",1),h.Pb(2,"ion-buttons",2),h.Kb(3,"ion-menu-button"),h.Ob(),h.Pb(4,"ion-title"),h.uc(5,"Sifari\u015fl\u0259r"),h.Ob(),h.Pb(6,"ion-buttons",3),h.Pb(7,"ion-button",4),h.Xb("click",(function(){return t.pay(t.orders)})),h.Kb(8,"ion-icon",5),h.Ob(),h.Pb(9,"ion-button",4),h.Xb("click",(function(){return t.isFilterActive=!t.isFilterActive})),h.Kb(10,"ion-icon",6),h.Ob(),h.Ob(),h.Ob(),h.sc(11,y,2,1,"ion-toolbar",7),h.Ob(),h.sc(12,C,7,3,"ion-content",8),h.sc(13,S,5,0,"ion-content",8)),2&e&&(h.gc("translucent",!1),h.zb(11),h.gc("ngIf",t.isSearchActive),h.zb(1),h.gc("ngIf",!t.isLoading),h.zb(1),h.gc("ngIf",t.isLoading))},directives:[r.t,r.bb,r.h,r.F,r.ab,r.g,r.u,n.k,r.O,r.nb,o.f,o.i,r.p,r.K,r.L,r.x,r.B,r.R,r.mb,r.S,n.j,r.s,r.N,r.o,r.A,r.lb,s.h,r.Z,r.v,r.Y,r.z,r.y,r.i,r.j,r.W],pipes:[n.r],styles:["ion-thumbnail[_ngcontent-%COMP%]{--size:100px}"]}),e})()},{path:"order-detail",loadChildren:()=>i.e(6).then(i.bind(null,"arML")).then(e=>e.OrderDetailPageModule)},{path:"add-order",loadChildren:()=>Promise.all([i.e(0),i.e(26)]).then(i.bind(null,"+JV4")).then(e=>e.AddOrderPageModule)}];let Z=(()=>{class e{}return e.\u0275mod=h.Hb({type:e}),e.\u0275inj=h.Gb({factory:function(t){return new(t||e)},imports:[[s.j.forChild(M)],s.j]}),e})(),F=(()=>{class e{}return e.\u0275mod=h.Hb({type:e}),e.\u0275inj=h.Gb({factory:function(t){return new(t||e)},imports:[[n.b,o.a,r.cb,Z]]}),e})()}}]);